# Railway deployment configuration for ChampMail backend
# Docs: https://docs.railway.app/deploy/railway-toml-reference

[build]
builder = "DOCKERFILE"
dockerfilePath = "backend/Dockerfile"

[deploy]
# Run migrations before starting the app
startCommand = "sh -c 'cd /app && (alembic upgrade head || echo \"Migration warning: $?\") && uvicorn app.main:app --host 0.0.0.0 --port $PORT'"
healthcheckPath = "/health/ready"
healthcheckTimeout = 100
restartPolicyType = "ON_FAILURE"
restartPolicyMaxRetries = 10

[env]
# These environment variables should be set in Railway dashboard
# Required:
# - ENVIRONMENT=production
# - JWT_SECRET_KEY=<generate with: openssl rand -hex 32>
# - WEBHOOK_SECRET=<generate with: openssl rand -hex 32>
# - FRONTEND_URL=https://your-frontend.railway.app
#
# AI (single key for everything):
# - OPENROUTER_API_KEY=sk-or-v1-your-key
#
# Database (auto-provided by Railway PostgreSQL plugin):
# - POSTGRES_HOST
# - POSTGRES_PORT
# - POSTGRES_USER
# - POSTGRES_PASSWORD
# - POSTGRES_DB
#
# Redis (auto-provided by Railway Redis plugin):
# - REDIS_HOST
# - REDIS_PORT
